<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vocabulario N5 - Asallam Sensei</title>
<style>
  body{
    background:#fffaf3;
    font-family:Arial;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding-top:20px;
  }
  
  h1{
  font-size:clamp(22px, 5vw, 32px);
  margin-top:16px;
  margin-bottom:10px;
  text-align:center;
  }


  /* Pregunta (JP grande por defecto) */
  #kanji{
    font-size:96px;
    margin:35px 0 10px 0;
    font-weight:bold;
    text-align:center;
    line-height:1.1;
    width:min(900px, 94vw);
    word-break:break-word;
  }

  /* ✅ cuando el modo sea Español → JP, achicamos la pregunta */
  #kanji.esPregunta{
    font-size:44px;
    font-weight:700;
    line-height:1.25;
  }

  button{
    padding:12px 20px;
    margin:5px;
    font-size:18px;
    border-radius:10px;
    border:none;
    background:#d97706;
    color:white;
    cursor:pointer;
  }
  button:hover{ background:#b45309; }

  #opbtns{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-top:10px;
  }
  
  .btnABC{
    padding:10px 16px;
    font-size:18px;
    border-radius:10px;
    border:none;
    background:#b94a48;        /* rojo apagado */
    color:#fff;
    cursor:pointer;
    min-width:64px;
    font-weight:700;
  }
  .btnABC:hover{
    background:#a94442;        /* un poco más oscuro */
  }

  .btnNav{
    padding:12px 20px;
    margin:5px;
    font-size:18px;
    border-radius:10px;
    border:none;
    background:#3b82b6;      /* azul mate */
    color:white;
    cursor:pointer;
    font-weight:700;
  }
  .btnNav:hover{
    background:#2563eb;      /* un poco más profundo */
  }

  #opciones{
    font-size:22px;
    margin-top:20px;
    text-align:left;
    line-height:1.7;
    width:min(520px, 92vw);
  }

  #navBtns{
    margin-top:14px;
    display:flex;
    justify-content:center;
  }

  
  #respuestaUsuario{
    margin-top:15px;
    font-size:22px;
    padding:8px 12px;
    border-radius:8px;
    border:2px solid #aaa;
    text-align:center;
    width:14ch;
  }

  .correcto{ color:#28a745; font-weight:bold; }
  .incorrecto{ color:#d93025; font-weight:bold; }

  #resultado{ margin-top:15px; font-size:22px; text-align:center; }
  #estadisticas{ margin-top:10px; font-size:20px; text-align:center; }

  #controles{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    justify-content:center;
    margin-top:10px;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border:1px solid #e5e7eb;
    border-radius:999px;
    background:white;
    font-size:16px;
  }
  select{
    font-size:16px;
    padding:6px 10px;
    border-radius:8px;
    border:1px solid #ccc;
    background:white;
  }
</style>
</head>

<body>
<h1>Vocabulario N5 — Asallam Sensei</h1>

<div id="controles">
  <span class="chip">
    Modo:
    <select id="modo" onchange="cambiarModo()">
      <option value="jp-es" selected>JP → Español</option>
      <option value="es-jp">Español → JP</option>
    </select>
  </span>
</div>

<div id="kanji">学校</div>

<div id="opciones"></div>

<div id="opbtns">
  <button class="btnABC" type="button" onclick="responder('a')">a</button>
  <button class="btnABC" type="button" onclick="responder('b')">b</button>
  <button class="btnABC" type="button" onclick="responder('c')">c</button>
</div>

<input id="respuestaUsuario"
       type="text"
       placeholder="a / b / c + Enter"
       maxlength="1"
       onkeydown="manejarEnter(event)">
  
<div id="navBtns">
  <button class="btnNav" type="button" onclick="accionSiguiente()">Siguiente</button>
  <button class="btnNav" onclick="mostrarRespuesta()">Mostrar respuesta</button>
</div>

<div id="resultado"></div>

<div id="estadisticas">
  Aciertos: <span id="aciertos">0</span> —
  Errores: <span id="errores">0</span>
</div>

<script>
let lista = [];
let actual = 0;
let aciertos = 0;
let errores = 0;
let correcta = "";
let respuestaCorrecta = "";
let yaValidado = false;
let focoAutomatico = false; // por defecto: NO abrir teclado

const letras = ["a","b","c"];

// Si el usuario toca/clickea el input, permitimos foco automático después
document.addEventListener("pointerdown", (e) => {
  focoAutomatico = (e.target && e.target.id === "respuestaUsuario");
});

// Si el usuario presiona teclas, asumimos que quiere modo teclado
document.addEventListener("keydown", (e) => {
  // si presiona a/b/c o Enter, activamos modo teclado
  if(["a","b","c","Enter"].includes(e.key)) focoAutomatico = true;
});

  
// ✅ Cambia aquí si tu archivo está en otra ruta/nombre:
fetch("data/Vocabulario_N5.json")
  .then(res => res.json())
  .then(data => {
    lista = (data || []).filter(x => x && x.kanji && x.significado);
    siguiente();
  });

function getModo(){
  return document.getElementById("modo").value; // "jp-es" o "es-jp"
}

function textoPregunta(item){
  return getModo()==="jp-es" ? item.kanji : item.significado;
}

function textoRespuesta(item){
  return getModo()==="jp-es" ? item.significado : item.kanji;
}

function aplicarEstiloPregunta(){
  const el = document.getElementById("kanji");
  if (getModo()==="es-jp") {
    el.classList.add("esPregunta");   // español más pequeño
  } else {
    el.classList.remove("esPregunta"); // japonés grande
  }
}

function accionSiguiente(){
  // Si NO ha respondido aún → cuenta como error y avanza
  if(!yaValidado){
    errores++;
    document.getElementById("errores").innerText = errores;
    yaValidado = true;
  }

  siguiente();
}

function siguiente(){
  if (lista.length < 3) return;

  actual = Math.floor(Math.random() * lista.length);
  const itemCorrecto = lista[actual];

  respuestaCorrecta = textoRespuesta(itemCorrecto);

  // opciones
  let opciones = [respuestaCorrecta];
  while (opciones.length < 3) {
    const rItem = lista[Math.floor(Math.random() * lista.length)];
    const r = textoRespuesta(rItem);
    if (!opciones.includes(r)) opciones.push(r);
  }

  // mezclar
  opciones.sort(() => Math.random() - 0.5);
  correcta = letras[opciones.indexOf(respuestaCorrecta)];

  // mostrar
  aplicarEstiloPregunta();
  document.getElementById("kanji").innerText = textoPregunta(itemCorrecto);

  document.getElementById("opciones").innerHTML =
    `a) ${opciones[0]}<br>
     b) ${opciones[1]}<br>
     c) ${opciones[2]}`;

  document.getElementById("resultado").innerText = "";
  document.getElementById("resultado").className = "";
  document.getElementById("respuestaUsuario").value = "";
  if (focoAutomatico) {
    document.getElementById("respuestaUsuario").focus();
  }
  

  yaValidado = false;
}

function responder(letra){
  focoAutomatico = false;
  if(yaValidado) return; // si ya respondió, no permitir doble
  document.getElementById("respuestaUsuario").value = letra;
  verificar();
}

  
function verificar(){
  const r = document.getElementById("respuestaUsuario").value.toLowerCase().trim();
  const res = document.getElementById("resultado");

  if (r === correcta) {
    res.innerText = "Correcto ✔";
    res.className = "correcto";
    aciertos++;
    document.getElementById("aciertos").innerText = aciertos;
  } else {
    res.innerText = `Incorrecto ✘ (era ${correcta})`;
    res.className = "incorrecto";
    errores++;
    document.getElementById("errores").innerText = errores;
  }

  yaValidado = true;
}

function mostrarRespuesta(){
  const res = document.getElementById("resultado");
  res.innerText = `Respuesta: ${respuestaCorrecta}`;
  res.className = "";
}

function manejarEnter(event){
  if (event.key !== "Enter") return;

  if (!yaValidado) {
    verificar();
  } else {
    siguiente();
  }
}

function cambiarModo(){
  // no toca el placeholder "a / b / c"
  yaValidado = false;
  document.getElementById("resultado").innerText = "";
  document.getElementById("respuestaUsuario").value = "";
  siguiente();
}
</script>
</body>
</html>
