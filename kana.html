<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Repaso de Kana - Asallam Sensei</title>
<style>
    body {
        background: #f6f6ff;
        font-family: Arial;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 40px;
    }

    h1 {
        margin-bottom: 10px;
    }

    #kana {
        font-size: 120px;
        margin: 40px 0;
        font-weight: bold;
    }

    button {
        padding: 12px 20px;
        margin: 5px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        background: #7d5cff;
        color: white;
        cursor: pointer;
    }

    button:hover {
        background: #5d46d4;
    }

    #respuesta {
        font-size: 30px;
        margin-top: 20px;
    }
    
    .correcto {
        color: #28a745; /* verde bonito */
        font-weight: bold;
    }
    
    .incorrecto {
        color: #d93025; /* rojo fuerte */
        font-weight: bold;
    }

    
#respuestaUsuario {
    margin-top: 15px;
    font-size: 22px;
    padding: 8px 12px;
    border-radius: 8px;
    border: 2px solid #aaa;
    text-align: center;
}

    /* Contenedor de los botones de modo */
    #modo-container {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    /* Botones de modo (hiragana/katakana/mezcla) */
    .modo-btn {
        font-size: 16px;
        padding: 8px 14px;
        background: #ddddff;
        color: #333;
    }

    .modo-btn.activo {
        background: #7d5cff;
        color: white;
    }

    #estadisticas {
    margin-top: 20px;
    font-size: 22px;
    }
    
    #btn-principiante {
      opacity: 0.45;
    }
    
    #btn-principiante.activo {
      opacity: 1;
      background: #e03131;
      color: white;
    }

    #opcionesABC, #acciones{
      display:flex;
      gap:10px;
      margin-top:10px;
      justify-content:center;
    }
    
    .abc-btn{
      font-size:18px;
      padding:10px 16px;
      border-radius:10px;
      border:none;
      background:#ddddff;
      color:#333;
      cursor:pointer;
    }
    
    .abc-btn:hover{ background:#cfcfff; }
    
    .accion-btn{
      padding:12px 18px;
      border-radius:10px;
      border:none;
      background:#7d5cff;
      color:white;
      cursor:pointer;
      font-size:18px;
    }
    
    .accion-btn:hover{ background:#5d46d4; }


    
</style>
</head>
<body>

<h1>Repaso de Kana — Asallam Sensei</h1>

<!-- Botones para seleccionar el modo -->
<div id="modo-container">
    <button id="btn-hiragana" class="modo-btn" onclick="setModo('hiragana')">Hiragana</button>
    <button id="btn-katakana" class="modo-btn" onclick="setModo('katakana')">Katakana</button>
    <button id="btn-mezcla"   class="modo-btn" onclick="setModo('mezcla')">Mezcla</button>
    <button id="btn-extra"    class="modo-btn" onclick="setModo('extra')">Extra</button>
    <button id="btn-principiante" class="modo-btn" onclick="togglePrincipiante()">Principiante</button>
</div>

<div id="kana">あ</div>

<div id="respuesta"></div>

<div id="opcionesABC">
  <button class="abc-btn" onclick="elegirABC('a')">A</button>
  <button class="abc-btn" onclick="elegirABC('b')">B</button>
  <button class="abc-btn" onclick="elegirABC('c')">C</button>
</div>
    
<input id="respuestaUsuario" 
       type="text" 
       placeholder="Escribe el romaji aquí"
       onkeydown="manejarEnter(event)">

<div id="acciones">
  <button class="accion-btn" onclick="mostrarRespuesta()">Mostrar respuesta</button>
  <button class="accion-btn" onclick="siguienteDesdeBoton()">Siguiente</button>
</div>

    
<div id="estadisticas">
    Aciertos: <span id="aciertos">0</span> — 
    Errores: <span id="errores">0</span>
</div>

<button class="modo-btn" onclick="resetStatsModo()">Reset stats</button>
    
<script>

let hiragana = [];
let katakana = [];
let extra = [];
let hiraganaBase = [];
let katakanaBase = [];

let filtroPrincipiante = false;

const GOJUON = [
  "a","i","u","e","o",
  "ka","ki","ku","ke","ko",
  "sa","shi","su","se","so",
  "ta","chi","tsu","te","to",
  "na","ni","nu","ne","no",
  "ha","hi","fu","he","ho",
  "ma","mi","mu","me","mo",
  "ya","yu","yo",
  "ra","ri","ru","re","ro",
  "wa","wo","n"
];
    
// Cargar datos desde JSON
fetch("data/kana.json")
    .then(res => res.json())
    .then(data => {
      hiraganaBase = data.hiragana;
      katakanaBase = data.katakana;
      extra = data.Extra; // ✅ EXTRA queda igual
    
      // ✅ Inicializar listas “activas” en modo normal
      hiragana = hiraganaBase;
      katakana = katakanaBase;
    
      // Si el toggle estuviera ON por alguna razón, aplica filtro
      aplicarFiltroPrincipiante();
    
      setModo("hiragana");
      
    });

// ===============================
// LÓGICA DEL JUEGO
// ===============================
let modoActual = "hiragana";       // "hiragana" | "katakana" | "mezcla"
let kanaLista = hiragana;          // lista usada en cada momento
let actual = 0;
let yaValidado = false;
let aciertos = 0;
let errores = 0;

// ===============================
// ✅ GUARDADO (localStorage)
// ===============================
const STATS_KEY = "kanaStats_v1";

// trae el objeto completo de stats guardado
function cargarStats() {
  try {
    return JSON.parse(localStorage.getItem(STATS_KEY)) || {};
  } catch {
    return {};
  }
}

// guarda el objeto completo
function guardarStats(stats) {
  localStorage.setItem(STATS_KEY, JSON.stringify(stats));
}

// obtiene stats del modo (si no existe, lo crea)
function getStatsModo(modo) {
  const stats = cargarStats();
  if (!stats[modo]) stats[modo] = { aciertos: 0, errores: 0 };
  return stats;
}

// carga stats del modo actual a las variables aciertos/errores
function cargarStatsActual() {
  const stats = getStatsModo(modoActual);
  aciertos = stats[modoActual].aciertos || 0;
  errores  = stats[modoActual].errores  || 0;
  actualizarEstadisticas();
}

// guarda las variables aciertos/errores del modo actual
function guardarStatsActual() {
  const stats = getStatsModo(modoActual);
  stats[modoActual].aciertos = aciertos;
  stats[modoActual].errores = errores;
  guardarStats(stats);
}
    
function setModo(modo) {
    modoActual = modo;

    if (modo === "hiragana") {
        kanaLista = hiragana;
    } else if (modo === "katakana") {
        kanaLista = katakana;
    } else if (modo === "extra") {
        kanaLista = extra;
    } else { // mezcla
        kanaLista = [...hiragana, ...katakana];
    }

    // ✅ Cargar estadísticas guardadas para este modo
    cargarStatsActual();
    
    // actualizar estado visual de los botones
    const botones = document.querySelectorAll(".modo-btn");
    botones.forEach(b => {
      if (b.id !== "btn-principiante") b.classList.remove("activo");
    });
    document.getElementById("btn-" + modo).classList.add("activo");

    // limpiar respuesta anterior
    document.getElementById("respuesta").innerText = "";
    document.getElementById("respuesta").className = "";

    // resetear estado de validación
    yaValidado = false;

    // mostrar un nuevo kana del nuevo modo
    siguienteKana();
}

function siguienteKana() {
    actual = Math.floor(Math.random() * kanaLista.length);
    document.getElementById("kana").innerText = kanaLista[actual][0];
    document.getElementById("respuesta").innerText = "";
    document.getElementById("respuestaUsuario").value = "";
    yaValidado = false;  
    document.getElementById("respuestaUsuario").focus();
    document.getElementById("respuesta").className = "";
}

function mostrarRomaji() {
    document.getElementById("respuesta").innerText = kanaLista[actual][1];
}

function verificarRespuesta() {
    const usuario = document.getElementById("respuestaUsuario").value.trim().toLowerCase();
    const correcto = kanaLista[actual][1];

    if (usuario === correcto) {
        document.getElementById("respuesta").innerText = "Correcto ✔ (" + correcto + ")";
        document.getElementById("respuesta").className = "correcto";   // ← AÑADIDO
        aciertos++;
    } else {
        document.getElementById("respuesta").innerText = "Incorrecto ✘ (era: " + correcto + ")";
        document.getElementById("respuesta").className = "incorrecto"; // ← AÑADIDO
        errores++;
    }
    actualizarEstadisticas();
    guardarStatsActual(); // ✅ guardar en localStorage
    yaValidado = true;  // señal de que ya se revisó la respuesta
}

function manejarEnter(event) {
    if (event.key !== "Enter") return;

    if (!yaValidado) {
        // Primer Enter → revisar respuesta
        verificarRespuesta();
    } else {
        // Segundo Enter → pasar al siguiente kana
        yaValidado = false;
        document.getElementById("respuesta").innerText = "";
        siguienteKana();
    }
}

function actualizarEstadisticas() {
    document.getElementById("aciertos").innerText = aciertos;
    document.getElementById("errores").innerText = errores;
}

function aplicarFiltroPrincipiante() {
  // si está OFF → listas completas
  if (!filtroPrincipiante) {
    hiragana = hiraganaBase;
    katakana = katakanaBase;
    return;
  }

  // si está ON → solo 46 básicos (solo hira/kata)
  hiragana = hiraganaBase.filter(k => GOJUON.includes(k[1]));
  katakana = katakanaBase.filter(k => GOJUON.includes(k[1]));
}

function togglePrincipiante() {
  filtroPrincipiante = !filtroPrincipiante;

  // visual del botón (opaco vs activo)
  const btn = document.getElementById("btn-principiante");
  if (filtroPrincipiante) btn.classList.add("activo");
  else btn.classList.remove("activo");

  // aplicar filtro SOLO a hiragana/katakana (extra no se toca)
  aplicarFiltroPrincipiante();

  // si estás en extra, no hacer nada más (extra queda igual)
  if (modoActual === "extra") return;

  // refrescar el modo actual (hiragana/katakana/mezcla)
  setModo(modoActual);
}

function resetStatsModo() {
  aciertos = 0;
  errores = 0;
  actualizarEstadisticas();
  guardarStatsActual();
}

function elegirABC(letra){
  // pone a/b/c en el input y valida como si hubiera Enter
  document.getElementById("respuestaUsuario").value = letra;
  if (!yaValidado) verificarRespuesta();
}

function siguienteDesdeBoton(){
  // si no ha validado, primero valida (como primer Enter)
  if (!yaValidado) {
    verificarRespuesta();
    return;
  }
  // si ya validó, pasa al siguiente (como segundo Enter)
  document.getElementById("respuesta").innerText = "";
  siguienteKana();
}

function mostrarRespuesta(){
  // muestra el romaji (sin contar como acierto/error)
  document.getElementById("respuesta").innerText = "Respuesta: " + kanaLista[actual][1];
  document.getElementById("respuesta").className = "";
}


    
</script>

</body>
</html>


